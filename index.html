<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bing å£çº¸ Pro</title>
  <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiQmluZyBXYWxscGFwZXIiLCJzdGFydF91cmwiOiIuL2luZGV4Lmh0bWwiLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInRoZW1lX2NvbG9yIjoiI2ZmZiIsImJhY2tncm91bmRfY29sb3IiOiIjMDAwIiwiZGVzY3JpcHRpb24iOiLlrprlrrnljJZCaW5n6aG16Z2i6L+U55SoIiwiaWNvbnMiOlt7InNyYyI6Ii8vaS5wbmcid2VpZ2h0OjMyLCJoZWlnaHQiOjMyfV19">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      transition: background-image 1s ease-in-out;
      background-size: cover;
      background-position: center;
      color: white;
    }
    .overlay {
      background-color: rgba(0,0,0,0.3);
      height: 100%;
      width: 100%;
      position: absolute;
      z-index: 0;
    }
    .container {
      position: relative;
      z-index: 1;
      padding: 2em;
      text-align: center;
    }
    button, input, select {
      margin: 0.5em;
      padding: 0.6em 1em;
      font-size: 1em;
      border: none;
      border-radius: 5px;
    }
    #darkToggle {
      background-color: #444;
      color: #fff;
    }
    .dark-mode {
      background-color: #111 !important;
      color: #eee !important;
    }
  </style>
</head>
<body>
<div class="overlay"></div>
<div class="container">
  <h1>Bing å£çº¸ Â· Pro ç‰ˆ</h1>
  <p id="caption">åŠ è½½ä¸­...</p>
  <div>
    <button onclick="fetchBing()">ğŸ”„ åˆ·æ–°å£çº¸</button>
    <button onclick="download4k()">ğŸ“¥ ä¸‹è½½4K</button>
    <button onclick="copyLink()">ğŸ”— å¤åˆ¶é“¾æ¥</button>
    <button onclick="toggleDark()">ğŸŒ“ é»‘æš—æ¨¡å¼</button>
  </div>
  <div>
    <input id="searchInput" type="text" placeholder="æœç´¢å£çº¸å…³é”®è¯">
    <button onclick="searchWallpaper()">ğŸ” æœç´¢</button>
  </div>
  <div>
    <select id="marketSelect" onchange="fetchBing()">
      <option value="zh-CN">ä¸­å›½</option>
      <option value="en-US">ç¾å›½</option>
      <option value="ja-JP">æ—¥æœ¬</option>
      <option value="en-GB">è‹±å›½</option>
    </select>
    <input type="date" id="datePicker" max="" onchange="fetchByDate()"/>
  </div>
  <div>
    <button onclick="toggleSlideshow()">ğŸï¸ æ’­æ”¾/åœæ­¢å¹»ç¯ç‰‡</button>
    <button onclick="toggleFavorite()">â¤ï¸ æ”¶è—</button>
    <button onclick="viewFavorites()">ğŸ“š æŸ¥çœ‹æ”¶è—</button>
  </div>
  <blockquote id="quote"></blockquote>
</div>

<script>
  let currentImageUrl = "";
  let currentDownloadUrl = "";
  let isDark = false;
  let slideTimer = null;
  let slideIndex = 0;

  const quotes = [
    "æ¯ä¸€ä¸ªæ¸…æ™¨ï¼Œéƒ½æ˜¯é‡æ–°å¼€å§‹çš„æœºä¼šã€‚",
    "å¤©ç©ºè¶Šé»‘ï¼Œæ˜Ÿæ˜Ÿè¶Šäº®ã€‚",
    "è·¯é¥çŸ¥é©¬åŠ›ï¼Œæ—¥ä¹…è§äººå¿ƒã€‚",
    "è¯»ä¸‡å·ä¹¦ï¼Œè¡Œä¸‡é‡Œè·¯ã€‚",
    "é™ä»¥ä¿®èº«ï¼Œä¿­ä»¥å…»å¾·ã€‚",
    "Stay hungry, stay foolish.",
    "Simplicity is the ultimate sophistication."
  ];

  function fetchBing(offset = 0) {
    const market = document.getElementById("marketSelect").value;
    fetch(`https://www.bing.com/HPImageArchive.aspx?format=js&idx=${offset}&n=1&mkt=${market}&uhd=1&uhdwidth=3840&uhdheight=2160`)
    .then(r => r.json())
    .then(d => {
      const img = d.images[0];
      currentImageUrl = "https://www.bing.com" + img.url;
      currentDownloadUrl = "https://www.bing.com" + img.urlbase + "_UHD.jpg";
      document.body.style.backgroundImage = `url('${currentImageUrl}')`;
      document.getElementById("caption").innerText = img.copyright;
      document.getElementById("datePicker").value = img.enddate.replace(/^(\d{4})(\d{2})(\d{2})$/, '$1-$2-$3');
    });
  }

  function fetchByDate() {
    const selected = document.getElementById("datePicker").value;
    const date = new Date(selected);
    const today = new Date();
    const offset = Math.floor((today - date) / (1000 * 60 * 60 * 24));
    if (offset >= 0 && offset <= 7) {
      fetchBing(offset);
    } else {
      alert("Bing ä»…æ”¯æŒæœ€è¿‘ 7 å¤©çš„å†å²å£çº¸ã€‚");
    }
  }

  function download4k() {
    window.open(currentDownloadUrl, "_blank");
  }

  function searchWallpaper() {
    const q = document.getElementById("searchInput").value.trim();
    if (q) window.open(`https://www.pexels.com/zh-cn/search/${encodeURIComponent(q)}/`, "_blank");
  }

  function copyLink() {
    navigator.clipboard.writeText(currentDownloadUrl).then(() => alert("ä¸‹è½½é“¾æ¥å·²å¤åˆ¶ï¼"));
  }

  function toggleDark() {
    document.body.classList.toggle("dark-mode");
    isDark = !isDark;
  }

  function toggleSlideshow() {
    if (slideTimer) {
      clearInterval(slideTimer);
      slideTimer = null;
      alert("å¹»ç¯ç‰‡å·²åœæ­¢");
    } else {
      slideIndex = 0;
      slideTimer = setInterval(() => {
        fetchBing(slideIndex);
        slideIndex = (slideIndex + 1) % 7;
      }, 6000);
      alert("å¹»ç¯ç‰‡æ’­æ”¾ä¸­");
    }
  }

  function toggleFavorite() {
    const favs = JSON.parse(localStorage.getItem("favs") || "[]");
    if (!favs.includes(currentDownloadUrl)) {
      favs.push(currentDownloadUrl);
      localStorage.setItem("favs", JSON.stringify(favs));
      alert("å·²æ”¶è—ï¼");
    } else {
      alert("å·²å­˜åœ¨æ”¶è—å¤¹ä¸­");
    }
  }

  function viewFavorites() {
    const favs = JSON.parse(localStorage.getItem("favs") || "[]");
    if (favs.length === 0) return alert("æš‚æ— æ”¶è—ï½");
    const links = favs.map(f => `<a href="${f}" target="_blank">${f}</a>`).join("<br>");
    const win = window.open();
    win.document.write(`<h2>å·²æ”¶è—å£çº¸ï¼š</h2>${links}`);
  }

  function randomQuote() {
    const q = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById("quote").innerText = q;
  }

  window.onload = () => {
    fetchBing();
    randomQuote();
    document.getElementById("datePicker").max = new Date().toISOString().split("T")[0];
  }
</script>
</body>
</html>